(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[97352],{97352:(t,e,n)=>{n.r(e),n.d(e,{default:()=>U});var i=n(35548),r=n(54795),a=n(66094),o=n(42436),c=n(39998),s=n(68018),d=n(4594),p=n(25726),l=n(39527),u=n(37109),m=n(60902),g=n(275),f=n(51160);const h={ByNewCard:0,BySavedCard:1};var y=n(84439);const _=[{cardId:"1",firstSix:"4242",lastFour:"4242",cardType:"Visa"},{cardId:"2",firstSix:"5555",lastFour:"4444",cardType:"MasterCard"},{cardId:"3",firstSix:"2200",lastFour:"6404",cardType:"Mir"}];let x=(()=>{var t;class e{constructor(){this.isE2E=(0,i.f3M)(l.oDT)}preparePayment(t){return(0,y.H)(this.getRandomDelay()).pipe((0,f.U)((()=>t)))}getPrimaryCard(){return(0,y.H)(this.getRandomDelay()).pipe((0,f.U)((()=>_)),(0,f.U)((t=>({primary:t[0],cards:t}))))}pay(){return(0,y.H)(this.getRandomDelay()).pipe((0,f.U)((()=>{})))}getRandomDelay(){return this.isE2E?0:3e3*Math.random()}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵprov=i.Yz7({token:t,factory:t.ɵfac,providedIn:"root"}),e})();var C=n(34566);const v=["cardGroupedInput"];function b(t,e){if(1&t){const t=i.EpF();i.ynx(0),i.TgZ(1,"div",4)(2,"div",9),i.NdJ("click",(function(){const e=i.CHM(t).$implicit,n=i.oxw();return i.KtG(n.payBySelectedCard(e))})),i.TgZ(3,"div",10)(4,"div",11)(5,"div",12),i._uU(6,"Card number"),i.qZA(),i.TgZ(7,"div",13),i._UZ(8,"img",14),i.ALo(9,"tuiIcon"),i.TgZ(10,"div",15),i._uU(11),i.qZA()()()()()(),i.BQk()}if(2&t){const t=e.$implicit;i.xp6(8),i.Q6J("src",i.lcZ(9,3,"MasterCard"===t.cardType?"@tui.maestro":"Visa"===t.cardType?"@tui.visa":"@tui.mir"),i.LSH),i.xp6(3),i.AsE(" ",t.firstSix,"****",t.lastFour," ")}}function M(t,e){1&t&&(i.ynx(0),i._UZ(1,"input",16),i.BQk())}function k(t,e){1&t&&(i.TgZ(0,"p"),i._uU(1,"Please wait, we are loading fake cards..."),i.qZA())}function w(t,e){if(1&t&&(i.ynx(0),i.YNc(1,k,2,0,"p",5),i.TgZ(2,"tui-loader",17),i._UZ(3,"tui-input-card-group",18,19),i.qZA(),i.BQk()),2&t){const t=e.tuiLet,n=i.oxw();i.xp6(1),i.Q6J("ngIf",t),i.xp6(1),i.Q6J("overlay",!0)("showLoader",t),i.xp6(1),i.ekj("without-date",n.paymentMode===n.PAYMENT_MODE.BySavedCard),i.Q6J("autocomplete",!0)("cardValidator",n.cardValidator)("tuiTextfieldCleaner",n.paymentMode===n.PAYMENT_MODE.ByNewCard)}}function P(t,e){1&t&&(i.ynx(0),i.TgZ(1,"div",4)(2,"label",20),i._UZ(3,"input",21),i._uU(4," Remember card "),i.qZA()(),i.BQk())}function Z(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"div",22)(1,"button",23),i.NdJ("click",(function(){i.CHM(t);const e=i.oxw();return i.KtG(e.payByNewCard())})),i._uU(2," New card "),i.qZA()()}}let O=(()=>{var t;class e{constructor(){this.payService=(0,i.f3M)(x),this.destroyRef=(0,i.f3M)(i.ktI),this.form=new a.cw({card:new a.NI(null,[a.kI.required,t=>{const{value:e}=t;return e?.cvc&&e.cvc.length<3?{invalidCvc:!0}:null}]),saveCard:new a.NI(!0)}),this.context=(0,i.f3M)(s.yf),this.iOS=(0,i.f3M)(l.FAH),this.cards=[],this.paymentMode=h.ByNewCard,this.loading$=new m.X(!1),this.payProcessing$=new m.X(!1),this.amount=this.context?.data?.amount??0,this.PAYMENT_MODE=h}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(t){this.form.patchValue({card:{card:this.maskedNumber(t),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(p.n9),this.paymentMode=h.BySavedCard,this.cardGroupedInput?.focusCVC()}payByNewCard(){this.form.patchValue({card:null}),this.form.controls.card.addValidators(p.n9),this.paymentMode=h.ByNewCard,this.cardGroupedInput?.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe((0,r.sL)(this.destroyRef)).subscribe((()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()}),(()=>this.payProcessing$.next(!1))))}cardValidator(t){return(0,p.sV)(t)&&16===t.length}maskedNumber(t){return`${t.firstSix.toString().slice(0,-2)}***${t.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe((0,g.w)((t=>this.payService.getPrimaryCard().pipe((0,f.U)((e=>[t,e]))))),(0,r.sL)(this.destroyRef)).subscribe({next:([,t])=>{this.cards=t.cards,t.primary?this.payBySelectedCard(t.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵcmp=i.Xpm({type:t,selectors:[["pay-modal"]],viewQuery:function(t,e){if(1&t&&i.Gf(v,5),2&t){let t;i.iGM(t=i.CRH())&&(e.cardGroupedInput=t.first)}},standalone:!0,features:[i.jDz],decls:16,vars:16,consts:[[1,"modal-container"],[1,"title"],[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"form-block"],[4,"ngIf"],[4,"tuiLet"],["class","form-block is--links",4,"ngIf"],["appearance","primary","size","l","tuiButton","","type","submit",3,"loading","click"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],[1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"overlay","showLoader"],["formControlName","card",3,"autocomplete","cardValidator","tuiTextfieldCleaner"],["cardGroupedInput",""],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],[1,"form-block","is--links"],["iconStart","@tui.plus","tuiLink","",3,"click"]],template:function(t,e){if(1&t&&(i.TgZ(0,"div",0)(1,"h1",1),i._uU(2,"Pay by card"),i.qZA(),i.TgZ(3,"form",2),i.YNc(4,b,12,5,"ng-container",3),i.TgZ(5,"div",4),i.YNc(6,M,2,0,"ng-container",5),i.YNc(7,w,5,8,"ng-container",6),i.ALo(8,"async"),i.qZA(),i.YNc(9,P,5,0,"ng-container",5),i.YNc(10,Z,3,0,"div",7),i.qZA(),i.TgZ(11,"button",8),i.NdJ("click",(function(){return e.pay()})),i.ALo(12,"async"),i._uU(13),i.ALo(14,"async"),i.ALo(15,"tuiFormatNumber"),i.qZA()()),2&t){let t;i.xp6(3),i.Q6J("formGroup",e.form),i.xp6(1),i.Q6J("ngForOf",e.cards),i.xp6(2),i.Q6J("ngIf",e.iOS),i.xp6(1),i.Q6J("tuiLet",null!==(t=i.lcZ(8,8,e.loading$))&&void 0!==t&&t),i.xp6(2),i.Q6J("ngIf",e.paymentMode===e.PAYMENT_MODE.ByNewCard),i.xp6(1),i.Q6J("ngIf",e.paymentMode===e.PAYMENT_MODE.BySavedCard),i.xp6(1),i.Q6J("loading",!!i.lcZ(12,10,e.payProcessing$)),i.xp6(2),i.hij(" Pay ",i.lcZ(14,12,i.lcZ(15,14,e.amount))," ₽ ")}},dependencies:[a.UX,a._Y,a.Wl,a.JJ,a.JL,a.sg,a.u,d.sg,d.O5,o.lI3,o.xGO,u.RHD,d.Ov,o.mO6,l.iM$,l.biZ,o.A61,p.vh,C.T,o.qmE,u.u3Z,o.v4Q],styles:['[_nghost-%COMP%]     tui-input-card-group{width:100%!important}[_nghost-%COMP%]     tui-input-card-group.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-group.without-date tui-icon[icon="@tui.x"]{display:none}[_nghost-%COMP%]     tui-input-card-group .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{width:480px}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{width:100%}}.title[_ngcontent-%COMP%]{margin:0 0 16px;font-weight:500;font-size:18px;line-height:26px;letter-spacing:.18px}.form-block[_ngcontent-%COMP%]{position:relative;margin-bottom:16px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{height:56px;background:#fafbfb;border-radius:16px;border:2px solid #eaeaea;padding:0 16px;display:flex;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.24px;font-size:12px;line-height:18px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{width:36px;height:22px;background-position:center;background-repeat:no-repeat;margin-right:8px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:22px;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:14px;line-height:20px}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-left:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;width:100%;caret-color:transparent;cursor:none;color:transparent}'],changeDetection:0}),e})();var T=n(59756),A=n(74922),N=n(139),I=n(46953),S=n(10188),L=n(85454),J=n(40661);const U=(()=>{var t;class e{constructor(){this.dialogs=(0,i.f3M)(o.ROA),this.destroyRef=(0,i.f3M)(i.ktI),this.amountControl=new a.NI(100)}payByCard(){this.dialogs.open(new s.Al(O),{size:"auto",closeable:!0,data:{amount:this.amountControl.value}}).pipe((0,r.sL)(this.destroyRef)).subscribe()}}return(t=e).ɵfac=function(e){return new(e||t)},t.ɵcmp=i.Xpm({type:t,selectors:[["ng-component"]],standalone:!0,exportAs:"Example9",features:[i.jDz],decls:13,vars:12,consts:[[1,"container"],["tuiHintContent","The amount must be less than 1000 ₽","tuiHintDirection","top","tuiTextfieldPostfix","₽","tuiTextfieldSize","l",3,"formControl","tuiTextfieldCleaner","tuiTextfieldLabelOutside"],["inputmode","numeric","maxlength","5","tuiTextfieldLegacy",""],["tuiButton","",1,"pay-button",3,"click"],[1,"icon-group"],[3,"src"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0)(1,"tui-input-number",1),i._uU(2," 0 ... 999 ₽ "),i._UZ(3,"input",2),i.qZA(),i.TgZ(4,"button",3),i.NdJ("click",(function(){return e.payByCard()})),i.TgZ(5,"div",4),i._UZ(6,"img",5),i.ALo(7,"tuiIcon"),i._UZ(8,"img",5),i.ALo(9,"tuiIcon"),i._UZ(10,"img",5),i.ALo(11,"tuiIcon"),i.qZA(),i._uU(12," Pay "),i.qZA()()),2&t&&(i.xp6(1),i.Q6J("formControl",e.amountControl)("tuiTextfieldCleaner",!0)("tuiTextfieldLabelOutside",!0),i.xp6(5),i.Q6J("src",i.lcZ(7,6,"@tui.visa"),i.LSH),i.xp6(2),i.Q6J("src",i.lcZ(9,8,"@tui.maestro"),i.LSH),i.xp6(2),i.Q6J("src",i.lcZ(11,10,"@tui.mir"),i.LSH))},dependencies:[c._Hh,T.q,A.g,N.M,a.UX,a.JJ,a.oH,o.qmE,c.cnw,I.b,S.x,L.s,J.T,o.bZA,o.xGO,o.v4Q],styles:[".container[_ngcontent-%COMP%]{width:100%;max-width:30rem;margin:0 auto;padding-top:1.25rem}.pay-button[_ngcontent-%COMP%]{margin-top:1rem;width:100%}.icon-group[_ngcontent-%COMP%]{display:flex;gap:.125rem;background:#f6f6f6;padding:.125rem .3125rem;margin-right:.5rem;border-radius:.3125rem}img[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem}"],changeDetection:0}),e})()}}]);